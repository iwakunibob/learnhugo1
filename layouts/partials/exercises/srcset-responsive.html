{{- /*  get image resource  */ -}}
{{- $img := .page.Resources.GetMatch .src -}}
{{- /*  height to width ratio of src image  */ -}}
{{- /*  numbers must be converted to float before division  */ -}}
{{- if not $img -}}
  {{- warnf "no image resource found at %s%s" .page.RelPermalink .src -}}
{{- end -}}
{{- /*  set variables  */ -}}
{{- $src := "" -}}
{{- $srcset := slice -}}
{{- $widths := sort .widths -}}
{{- range $index, $width := .widths -}}
  {{- if gt $width $img.Width -}}
    {{- warnf "Source image %s is not wide enough to resize to %dpx" $img.RelPermalink $width -}}
  {{- end -}}
  {{- $imgResized := $img.Resize (printf "%dx" $width) -}}
  {{- $srcset = $srcset | append (printf "%s dw" $imgResized.RelPermalink $width) -}}
  {{ if eq (len .widths) (add $index 1) }}
    {{- $src = $imgResized -}}
  {{ end }}
{{- end -}}
{{- $srcset = delimit $srcset ", " -}}

<img 
  srcset="{{ $srcset }}"
  src="{{ $src.RelPermalink }}" 
  alt="{{ .alt }}"
  width="{{ $src.Width }}"
  height="{{ $src.Height }}"
  class="{{ .class | default "img-fluid" }}"
  sizes="{{ .sizes | default "100vw"}}">